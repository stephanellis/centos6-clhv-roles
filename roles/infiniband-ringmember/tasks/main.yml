---
- name: run interface templates
  template: src={{ item }} dest=/etc/sysconfig/network-scripts
  with_items:
    - ifcfg-ib0
    - ifcfg-ib1
  tags: [infiniband-ringmember, configs]

# this is a different technique for getting the port GUIDS
# for the opensm template
#- name: get ib port guids
#  shell: ibstat -p | paste -sd " "
#  register: ibports
#  ignore_errors: True
#  always_run: True
#  tags: [infiniband-ringmember, configs]

- name: run opensm sysconfig template
  template: src=opensm dest=/etc/sysconfig/opensm
  tags: [infiniband-ringmember, configs]
  notify: restart opensm

- name: install quagga
  yum: name=quagga state=installed
  tags: [infiniband-ringmember, packages]

- name: quagga config for ospf
  template: src={{ item }} dest=/etc/quagga/ owner=quagga group=quaggavt
  with_items:
    - zebra.conf
    - ospfd.conf
  tags: [infiniband-ringmember, configs]
  notify: restart quagga

- name: start and enabled quagga ospf
  service: name={{ item }} state=started enabled=yes
  with_items:
    - zebra
    - ospfd
  tags: [infiniband-ringmember, services]
